'use strict';

var app = angular.module('fireApp', ['firebase', 'ui.router', 'ui.bootstrap', 'ngAnimate']);

app.constant('FB_URL', 'https://resplendent-fire-8795.firebaseio.com/');

app.config(["$stateProvider", "$urlRouterProvider", function ($stateProvider, $urlRouterProvider) {
  $stateProvider.state('home', { url: '/', templateUrl: 'html/home.html' }).state('profile', {
    url: '/profile',
    templateUrl: 'html/profile.html',
    controller: 'profileCtrl',
    resolve: {
      profile: ["$authObj", "ProfileFactory", function ($authObj, ProfileFactory) {
        return $authObj.$requireAuth().then(function (authData) {
          return ProfileFactory(authData.uid).$loaded();
        });
      }]
    }
  }).state('threads', {
    url: '/threads',
    templateUrl: 'html/threads.html',
    controller: 'threadsCtrl' }).state('thread-detail', {
    url: '/thread-detail:threadId',
    templateUrl: '/html/threadDetail.html',
    controller: 'threadDetailCtrl',
    resolve: {
      thread: ["$threads", "$stateParams", function ($threads, $stateParams) {
        return $threads.getThread($stateParams.threadId).$loaded();
      }],
      posts: ["$threads", "$stateParams", function ($threads, $stateParams) {
        return $threads.getPosts($stateParams.threadId).$loaded();
      }]
    }
  });

  $urlRouterProvider.otherwise('/');
}]);

app.filter('reverse', function () {
  return function (items) {
    return items.slice().reverse();
  };
});
'use strict';

var app = angular.module('fireApp');

app.controller('mainCtrl', ["$scope", "$tweets", "$authObj", "ProfileFactory", function ($scope, $tweets, $authObj, ProfileFactory) {
  $scope.tweets = $tweets;
  $scope.authObj = $authObj;

  $scope.authObj.$onAuth(function (authData) {
    $scope.authData = authData;
    $scope.profile = ProfileFactory(authData.uid);
  });

  $scope.logout = function () {
    $scope.authObj.$unauth();
  };

  $scope.register = function (user) {
    $scope.authObj.$createUser(user).then(function (userData) {
      console.log('user created:', userData);
      return $scope.authObj.$authWithPassword(user);
    }).then(function (authData) {
      console.log('user logged in:', authData);
    }).catch(function (err) {
      console.log('err:', err);
    });
  };

  $scope.login = function (user) {
    $scope.authObj.$authWithPassword(user).then(function (authData) {
      console.log('user logged in:', authData);
    }).catch(function (err) {
      console.log('err:', err);
    });
  };
}]);
'use strict';

var app = angular.module('fireApp');

app.controller('profileCtrl', ["$scope", "$uibModal", "$log", "profile", function ($scope, $uibModal, $log, profile) {
  $scope.profile = profile;

  $scope.open = function () {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: 'html/editProfileModal.html',
      controller: 'editProfileModalCtrl',
      size: 'lg',
      resolve: {
        profileToEdit: function profileToEdit() {
          return angular.copy($scope.profile);
        }
      }
    });
    modalInstance.result.then(function (editedProfile) {
      $scope.profile.name = editedProfile.name;
      $scope.profile.color = editedProfile.color;
      $scope.profile.$save();
    }, function () {
      $log.info('Modal dismissed at: ' + new Date());
    });
  };
}]);

app.controller('editProfileModalCtrl', ["$scope", "$uibModalInstance", "profileToEdit", function ($scope, $uibModalInstance, profileToEdit) {
  $scope.editProfile = profileToEdit;
  $scope.save = function () {
    $uibModalInstance.close($scope.editProfile);
  };
  $scope.cancel = function () {
    $uibModalInstance.dismiss();
  };
}]);
'use strict';

var app = angular.module('fireApp');

app.controller('threadsCtrl', ["$scope", "$state", "$threads", function ($scope, $state, $threads) {
  console.log('threadsCtrl');

  $scope.threads = $threads.getArray();

  $scope.addThread = function () {
    $threads.create($scope.newThread.subject);
    $scope.newThread = {};
  };
}]);
'use strict';

var app = angular.module('fireApp');

app.factory('ProfileFactory', ["$firebaseObject", "FB_URL", function ($firebaseObject, FB_URL) {
  return function (uid) {
    if (!uid) {
      return {};
    };
    var profilesRef = new Firebase(FB_URL + 'profiles');
    var userRef = profilesRef.child(uid);
    return $firebaseObject(userRef);
  };
}]);

app.factory('$tweets', ["$firebaseArray", "FB_URL", function ($firebaseArray, FB_URL) {
  var ref = new Firebase(FB_URL);
  var tweetsRef = ref.child('tweets');
  return $firebaseArray(tweetsRef);
}]);

app.factory('$authObj', ["$firebaseAuth", "FB_URL", function ($firebaseAuth, FB_URL) {
  var ref = new Firebase(FB_URL);
  return $firebaseAuth(ref);
}]);

app.service('$threads', ["$firebaseArray", "$firebaseObject", "FB_URL", function ($firebaseArray, $firebaseObject, FB_URL) {
  var ref = new Firebase(FB_URL);
  var threadsRef = ref.child('threads');

  this.getArray = function () {
    return $firebaseArray(threadsRef);
  };

  this.create = function (subject) {
    return this.getArray().$loaded().then(function (threads) {
      return threads.$add({
        subject: subject
      });
    });
  };
  this.getThread = function (threadId) {
    var singleThreadRef = threadsRef.child(threadId);
    return $firebaseObject(singleThreadRef);
  };
  this.getPosts = function (threadId) {
    var postsRef = threadsRef.child(threadId).child('posts');
    return $firebaseArray(postsRef);
  };
}]);
// })
// app.factory('$threads', function($firebaseArray, FB_URL) {
//   var ref = new Firebase(FB_URL);
//   var threadsRef = ref.child('threads');
//
//   return {
//     getArray = function() {
//       return $firebaseArray(threadsRef);
//     },
//     create = function(subject) {
//       return this.getArray().$loaded()
//       .then(function(threads)
//         return threads.$add ({
//         subject: subject
//         })
//       })
//     }
// })
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL21haW5DdHJsLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUN0cmwuanMiLCJjb250cm9sbGVycy90aHJlYWRzQ3RybC5qcyIsInNlcnZpY2VzL2ZhY3Rvcmllcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFJLE1BQU0sUUFBUSxNQUFSLENBQWUsU0FBZixFQUEwQixDQUFDLFVBQUQsRUFBYSxXQUFiLEVBQTBCLGNBQTFCLEVBQTBDLFdBQTFDLENBQTFCLENBQU47O0FBRUosSUFBSSxRQUFKLENBQWEsUUFBYixFQUF1QiwrQ0FBdkI7O0FBRUEsSUFBSSxNQUFKLENBQUksQ0FBQSxnQkFBQSxFQUFBLG9CQUFBLEVBQU8sVUFBUyxjQUFULEVBQXlCLGtCQUF6QixFQUE2QztBQUN0RCxpQkFDRyxLQURILENBQ1MsTUFEVCxFQUNpQixFQUFFLEtBQUssR0FBTCxFQUFVLGFBQWEsZ0JBQWIsRUFEN0IsRUFFRyxLQUZILENBRVMsU0FGVCxFQUVvQjtBQUNoQixTQUFLLFVBQUw7QUFDQSxpQkFBYSxtQkFBYjtBQUNBLGdCQUFZLGFBQVo7QUFDQSxhQUFTO0FBQ1AsZUFBQSxDQUFBLFVBQUEsRUFBQSxnQkFBQSxFQUFTLFVBQVMsUUFBVCxFQUFtQixjQUFuQixFQUFtQztBQUMxQyxlQUFPLFNBQVMsWUFBVCxHQUF3QixJQUF4QixDQUE2QixVQUFBLFFBQUEsRUFBQTtBQUNsQyxpQkFBTyxlQUFlLFNBQVMsR0FBVCxDQUFmLENBQTZCLE9BQTdCLEVBQVAsQ0FEa0M7U0FBQSxDQUFwQyxDQUQwQztPQUFuQyxDQUFUO0tBREY7R0FOSixFQWNHLEtBZEgsQ0FjUyxTQWRULEVBY29CO0FBQ2hCLFNBQUssVUFBTDtBQUNBLGlCQUFhLG1CQUFiO0FBQ0EsZ0JBQVksYUFBWixFQWpCSixFQW1CRyxLQW5CSCxDQW1CUyxlQW5CVCxFQW1CMEI7QUFDdEIsU0FBSyx5QkFBTDtBQUNBLGlCQUFhLHlCQUFiO0FBQ0EsZ0JBQVksa0JBQVo7QUFDQSxhQUFTO0FBQ1AsY0FBQSxDQUFBLFVBQUEsRUFBQSxjQUFBLEVBQVEsVUFBUyxRQUFULEVBQW1CLFlBQW5CLEVBQWlDO0FBQ3ZDLGVBQU8sU0FBUyxTQUFULENBQW1CLGFBQWEsUUFBYixDQUFuQixDQUEwQyxPQUExQyxFQUFQLENBRHVDO09BQWpDLENBQVI7QUFHQSxhQUFBLENBQUEsVUFBQSxFQUFBLGNBQUEsRUFBTyxVQUFTLFFBQVQsRUFBbUIsWUFBbkIsRUFBaUM7QUFDdEMsZUFBTyxTQUFTLFFBQVQsQ0FBa0IsYUFBYSxRQUFiLENBQWxCLENBQXlDLE9BQXpDLEVBQVAsQ0FEc0M7T0FBakMsQ0FBUDtLQUpGO0dBdkJKLEVBRHNEOztBQWtDdEQscUJBQW1CLFNBQW5CLENBQTZCLEdBQTdCLEVBbENzRDtDQUE3QyxDQUFYOztBQXFDQSxJQUFJLE1BQUosQ0FBVyxTQUFYLEVBQXNCLFlBQVc7QUFDL0IsU0FBTyxVQUFTLEtBQVQsRUFBZ0I7QUFDckIsV0FBTyxNQUFNLEtBQU4sR0FBYyxPQUFkLEVBQVAsQ0FEcUI7R0FBaEIsQ0FEd0I7Q0FBWCxDQUF0QjtBQzNDQTs7QUFFQSxJQUFJLE1BQU0sUUFBUSxNQUFSLENBQWUsU0FBZixDQUFOOztBQUVKLElBQUksVUFBSixDQUFlLFVBQWYsRUFBZSxDQUFBLFFBQUEsRUFBQSxTQUFBLEVBQUEsVUFBQSxFQUFBLGdCQUFBLEVBQVksVUFBUyxNQUFULEVBQWlCLE9BQWpCLEVBQTBCLFFBQTFCLEVBQW9DLGNBQXBDLEVBQW9EO0FBQzdFLFNBQU8sTUFBUCxHQUFnQixPQUFoQixDQUQ2RTtBQUU3RSxTQUFPLE9BQVAsR0FBaUIsUUFBakIsQ0FGNkU7O0FBSTdFLFNBQU8sT0FBUCxDQUFlLE9BQWYsQ0FBdUIsVUFBUyxRQUFULEVBQW1CO0FBQ3hDLFdBQU8sUUFBUCxHQUFrQixRQUFsQixDQUR3QztBQUV4QyxXQUFPLE9BQVAsR0FBaUIsZUFBZSxTQUFTLEdBQVQsQ0FBaEMsQ0FGd0M7R0FBbkIsQ0FBdkIsQ0FKNkU7O0FBUzdFLFNBQU8sTUFBUCxHQUFnQixZQUFXO0FBQ3pCLFdBQU8sT0FBUCxDQUFlLE9BQWYsR0FEeUI7R0FBWCxDQVQ2RDs7QUFhN0UsU0FBTyxRQUFQLEdBQWtCLFVBQVMsSUFBVCxFQUFlO0FBQy9CLFdBQU8sT0FBUCxDQUFlLFdBQWYsQ0FBMkIsSUFBM0IsRUFDQyxJQURELENBQ00sVUFBUyxRQUFULEVBQW1CO0FBQ3ZCLGNBQVEsR0FBUixDQUFZLGVBQVosRUFBNkIsUUFBN0IsRUFEdUI7QUFFdkIsYUFBTyxPQUFPLE9BQVAsQ0FBZSxpQkFBZixDQUFpQyxJQUFqQyxDQUFQLENBRnVCO0tBQW5CLENBRE4sQ0FLQyxJQUxELENBS00sVUFBUyxRQUFULEVBQW1CO0FBQ3ZCLGNBQVEsR0FBUixDQUFZLGlCQUFaLEVBQStCLFFBQS9CLEVBRHVCO0tBQW5CLENBTE4sQ0FRQyxLQVJELENBUU8sVUFBUyxHQUFULEVBQWM7QUFDbkIsY0FBUSxHQUFSLENBQVksTUFBWixFQUFvQixHQUFwQixFQURtQjtLQUFkLENBUlAsQ0FEK0I7R0FBZixDQWIyRDs7QUEyQjdFLFNBQU8sS0FBUCxHQUFlLFVBQVMsSUFBVCxFQUFlO0FBQzVCLFdBQU8sT0FBUCxDQUFlLGlCQUFmLENBQWlDLElBQWpDLEVBQ0MsSUFERCxDQUNNLFVBQVMsUUFBVCxFQUFtQjtBQUN2QixjQUFRLEdBQVIsQ0FBWSxpQkFBWixFQUErQixRQUEvQixFQUR1QjtLQUFuQixDQUROLENBSUMsS0FKRCxDQUlPLFVBQVMsR0FBVCxFQUFjO0FBQ25CLGNBQVEsR0FBUixDQUFZLE1BQVosRUFBb0IsR0FBcEIsRUFEbUI7S0FBZCxDQUpQLENBRDRCO0dBQWYsQ0EzQjhEO0NBQXBELENBQTNCO0FDSkE7O0FBRUEsSUFBSSxNQUFNLFFBQVEsTUFBUixDQUFlLFNBQWYsQ0FBTjs7QUFFSixJQUFJLFVBQUosQ0FBZSxhQUFmLEVBQWUsQ0FBQSxRQUFBLEVBQUEsV0FBQSxFQUFBLE1BQUEsRUFBQSxTQUFBLEVBQWUsVUFBUyxNQUFULEVBQWlCLFNBQWpCLEVBQTRCLElBQTVCLEVBQWtDLE9BQWxDLEVBQTJDO0FBQ3ZFLFNBQU8sT0FBUCxHQUFpQixPQUFqQixDQUR1RTs7QUFHdkUsU0FBTyxJQUFQLEdBQWMsWUFBVztBQUN2QixRQUFJLGdCQUFnQixVQUFVLElBQVYsQ0FBZTtBQUNqQyxpQkFBVyxJQUFYO0FBQ0EsbUJBQWEsNEJBQWI7QUFDQSxrQkFBWSxzQkFBWjtBQUNBLFlBQU0sSUFBTjtBQUNBLGVBQVM7QUFDUCx1QkFBZSx5QkFBVztBQUN4QixpQkFBTyxRQUFRLElBQVIsQ0FBYSxPQUFPLE9BQVAsQ0FBcEIsQ0FEd0I7U0FBWDtPQURqQjtLQUxrQixDQUFoQixDQURtQjtBQVl2QixrQkFBYyxNQUFkLENBQXFCLElBQXJCLENBQTBCLFVBQVMsYUFBVCxFQUF3QjtBQUNoRCxhQUFPLE9BQVAsQ0FBZSxJQUFmLEdBQXNCLGNBQWMsSUFBZCxDQUQwQjtBQUVoRCxhQUFPLE9BQVAsQ0FBZSxLQUFmLEdBQXVCLGNBQWMsS0FBZCxDQUZ5QjtBQUdoRCxhQUFPLE9BQVAsQ0FBZSxLQUFmLEdBSGdEO0tBQXhCLEVBSXZCLFlBQVc7QUFDWixXQUFLLElBQUwsQ0FBVSx5QkFBeUIsSUFBSSxJQUFKLEVBQXpCLENBQVYsQ0FEWTtLQUFYLENBSkgsQ0FadUI7R0FBWCxDQUh5RDtDQUEzQyxDQUE5Qjs7QUF5QkEsSUFBSSxVQUFKLENBQWUsc0JBQWYsRUFBZSxDQUFBLFFBQUEsRUFBQSxtQkFBQSxFQUFBLGVBQUEsRUFBd0IsVUFBUyxNQUFULEVBQWlCLGlCQUFqQixFQUFvQyxhQUFwQyxFQUFtRDtBQUN4RixTQUFPLFdBQVAsR0FBcUIsYUFBckIsQ0FEd0Y7QUFFeEYsU0FBTyxJQUFQLEdBQWMsWUFBVztBQUN2QixzQkFBa0IsS0FBbEIsQ0FBd0IsT0FBTyxXQUFQLENBQXhCLENBRHVCO0dBQVgsQ0FGMEU7QUFLeEYsU0FBTyxNQUFQLEdBQWdCLFlBQVc7QUFDekIsc0JBQWtCLE9BQWxCLEdBRHlCO0dBQVgsQ0FMd0U7Q0FBbkQsQ0FBdkM7QUM3QkE7O0FBRUEsSUFBSSxNQUFNLFFBQVEsTUFBUixDQUFlLFNBQWYsQ0FBTjs7QUFFSixJQUFJLFVBQUosQ0FBZSxhQUFmLEVBQWUsQ0FBQSxRQUFBLEVBQUEsUUFBQSxFQUFBLFVBQUEsRUFBZSxVQUFTLE1BQVQsRUFBaUIsTUFBakIsRUFBeUIsUUFBekIsRUFBbUM7QUFDL0QsVUFBUSxHQUFSLENBQVksYUFBWixFQUQrRDs7QUFHL0QsU0FBTyxPQUFQLEdBQWlCLFNBQVMsUUFBVCxFQUFqQixDQUgrRDs7QUFLL0QsU0FBTyxTQUFQLEdBQW1CLFlBQVc7QUFDNUIsYUFBUyxNQUFULENBQWdCLE9BQU8sU0FBUCxDQUFpQixPQUFqQixDQUFoQixDQUQ0QjtBQUU1QixXQUFPLFNBQVAsR0FBbUIsRUFBbkIsQ0FGNEI7R0FBWCxDQUw0QztDQUFuQyxDQUE5QjtBQ0pBOztBQUVBLElBQUksTUFBTSxRQUFRLE1BQVIsQ0FBZSxTQUFmLENBQU47O0FBRUosSUFBSSxPQUFKLENBQVksZ0JBQVosRUFBWSxDQUFBLGlCQUFBLEVBQUEsUUFBQSxFQUFrQixVQUFTLGVBQVQsRUFBMEIsTUFBMUIsRUFBa0M7QUFDOUQsU0FBTyxVQUFTLEdBQVQsRUFBYztBQUNuQixRQUFHLENBQUMsR0FBRCxFQUFNO0FBQ1AsYUFBTyxFQUFQLENBRE87S0FBVCxDQURtQjtBQUluQixRQUFJLGNBQWMsSUFBSSxRQUFKLENBQWEsU0FBUyxVQUFULENBQTNCLENBSmU7QUFLbkIsUUFBSSxVQUFVLFlBQVksS0FBWixDQUFrQixHQUFsQixDQUFWLENBTGU7QUFNbkIsV0FBTyxnQkFBZ0IsT0FBaEIsQ0FBUCxDQU5tQjtHQUFkLENBRHVEO0NBQWxDLENBQTlCOztBQVdBLElBQUksT0FBSixDQUFZLFNBQVosRUFBWSxDQUFBLGdCQUFBLEVBQUEsUUFBQSxFQUFXLFVBQVMsY0FBVCxFQUF5QixNQUF6QixFQUFpQztBQUN0RCxNQUFJLE1BQU0sSUFBSSxRQUFKLENBQWEsTUFBYixDQUFOLENBRGtEO0FBRXRELE1BQUksWUFBWSxJQUFJLEtBQUosQ0FBVSxRQUFWLENBQVosQ0FGa0Q7QUFHdEQsU0FBTyxlQUFlLFNBQWYsQ0FBUCxDQUhzRDtDQUFqQyxDQUF2Qjs7QUFNQSxJQUFJLE9BQUosQ0FBWSxVQUFaLEVBQVksQ0FBQSxlQUFBLEVBQUEsUUFBQSxFQUFZLFVBQVMsYUFBVCxFQUF3QixNQUF4QixFQUFnQztBQUN0RCxNQUFJLE1BQU0sSUFBSSxRQUFKLENBQWEsTUFBYixDQUFOLENBRGtEO0FBRXRELFNBQU8sY0FBYyxHQUFkLENBQVAsQ0FGc0Q7Q0FBaEMsQ0FBeEI7O0FBS0EsSUFBSSxPQUFKLENBQVksVUFBWixFQUFZLENBQUEsZ0JBQUEsRUFBQSxpQkFBQSxFQUFBLFFBQUEsRUFBWSxVQUFTLGNBQVQsRUFBeUIsZUFBekIsRUFBMEMsTUFBMUMsRUFBa0Q7QUFDeEUsTUFBSSxNQUFNLElBQUksUUFBSixDQUFhLE1BQWIsQ0FBTixDQURvRTtBQUV4RSxNQUFJLGFBQWEsSUFBSSxLQUFKLENBQVUsU0FBVixDQUFiLENBRm9FOztBQUl4RSxPQUFLLFFBQUwsR0FBZ0IsWUFBVztBQUN6QixXQUFPLGVBQWUsVUFBZixDQUFQLENBRHlCO0dBQVgsQ0FKd0Q7O0FBUXhFLE9BQUssTUFBTCxHQUFjLFVBQVMsT0FBVCxFQUFrQjtBQUM5QixXQUFPLEtBQUssUUFBTCxHQUFnQixPQUFoQixHQUNOLElBRE0sQ0FDRCxVQUFTLE9BQVQsRUFBa0I7QUFDdEIsYUFBTyxRQUFRLElBQVIsQ0FBYztBQUNuQixpQkFBUyxPQUFUO09BREssQ0FBUCxDQURzQjtLQUFsQixDQUROLENBRDhCO0dBQWxCLENBUjBEO0FBZ0J4RSxPQUFLLFNBQUwsR0FBaUIsVUFBUyxRQUFULEVBQW1CO0FBQ2xDLFFBQUksa0JBQWtCLFdBQVcsS0FBWCxDQUFpQixRQUFqQixDQUFsQixDQUQ4QjtBQUVsQyxXQUFPLGdCQUFnQixlQUFoQixDQUFQLENBRmtDO0dBQW5CLENBaEJ1RDtBQW9CeEUsT0FBSyxRQUFMLEdBQWdCLFVBQVMsUUFBVCxFQUFtQjtBQUNqQyxRQUFJLFdBQVcsV0FBVyxLQUFYLENBQWlCLFFBQWpCLEVBQTJCLEtBQTNCLENBQWlDLE9BQWpDLENBQVgsQ0FENkI7QUFFakMsV0FBTyxlQUFlLFFBQWYsQ0FBUCxDQUZpQztHQUFuQixDQXBCd0Q7Q0FBbEQsQ0FBeEIiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2ZpcmVBcHAnLCBbJ2ZpcmViYXNlJywgJ3VpLnJvdXRlcicsICd1aS5ib290c3RyYXAnLCAnbmdBbmltYXRlJ10pO1xuXG5hcHAuY29uc3RhbnQoJ0ZCX1VSTCcsICdodHRwczovL3Jlc3BsZW5kZW50LWZpcmUtODc5NS5maXJlYmFzZWlvLmNvbS8nKTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICRzdGF0ZVByb3ZpZGVyXG4gICAgLnN0YXRlKCdob21lJywgeyB1cmw6ICcvJywgdGVtcGxhdGVVcmw6ICdodG1sL2hvbWUuaHRtbCcgfSlcbiAgICAuc3RhdGUoJ3Byb2ZpbGUnLCB7XG4gICAgICB1cmw6ICcvcHJvZmlsZScsXG4gICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvcHJvZmlsZS5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdwcm9maWxlQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHByb2ZpbGU6IGZ1bmN0aW9uKCRhdXRoT2JqLCBQcm9maWxlRmFjdG9yeSkge1xuICAgICAgICAgIHJldHVybiAkYXV0aE9iai4kcmVxdWlyZUF1dGgoKS50aGVuKChhdXRoRGF0YSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFByb2ZpbGVGYWN0b3J5KGF1dGhEYXRhLnVpZCkuJGxvYWRlZCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgICAuc3RhdGUoJ3RocmVhZHMnLCB7XG4gICAgICB1cmw6ICcvdGhyZWFkcycsXG4gICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvdGhyZWFkcy5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICd0aHJlYWRzQ3RybCd9KVxuXG4gICAgLnN0YXRlKCd0aHJlYWQtZGV0YWlsJywge1xuICAgICAgdXJsOiAnL3RocmVhZC1kZXRhaWw6dGhyZWFkSWQnLFxuICAgICAgdGVtcGxhdGVVcmw6ICcvaHRtbC90aHJlYWREZXRhaWwuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAndGhyZWFkRGV0YWlsQ3RybCcsXG4gICAgICByZXNvbHZlOiB7XG4gICAgICAgIHRocmVhZDogZnVuY3Rpb24oJHRocmVhZHMsICRzdGF0ZVBhcmFtcykge1xuICAgICAgICAgIHJldHVybiAkdGhyZWFkcy5nZXRUaHJlYWQoJHN0YXRlUGFyYW1zLnRocmVhZElkKS4kbG9hZGVkKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHBvc3RzOiBmdW5jdGlvbigkdGhyZWFkcywgJHN0YXRlUGFyYW1zKSB7XG4gICAgICAgICAgcmV0dXJuICR0aHJlYWRzLmdldFBvc3RzKCRzdGF0ZVBhcmFtcy50aHJlYWRJZCkuJGxvYWRlZCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG59KTtcblxuYXBwLmZpbHRlcigncmV2ZXJzZScsIGZ1bmN0aW9uKCkge1xuICByZXR1cm4gZnVuY3Rpb24oaXRlbXMpIHtcbiAgICByZXR1cm4gaXRlbXMuc2xpY2UoKS5yZXZlcnNlKCk7XG4gIH07XG59KTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdmaXJlQXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdtYWluQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHR3ZWV0cywgJGF1dGhPYmosIFByb2ZpbGVGYWN0b3J5KSB7XG4gICRzY29wZS50d2VldHMgPSAkdHdlZXRzO1xuICAkc2NvcGUuYXV0aE9iaiA9ICRhdXRoT2JqO1xuXG4gICRzY29wZS5hdXRoT2JqLiRvbkF1dGgoZnVuY3Rpb24oYXV0aERhdGEpIHtcbiAgICAkc2NvcGUuYXV0aERhdGEgPSBhdXRoRGF0YTtcbiAgICAkc2NvcGUucHJvZmlsZSA9IFByb2ZpbGVGYWN0b3J5KGF1dGhEYXRhLnVpZCk7XG4gIH0pO1xuXG4gICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAkc2NvcGUuYXV0aE9iai4kdW5hdXRoKCk7XG4gIH07XG5cbiAgJHNjb3BlLnJlZ2lzdGVyID0gZnVuY3Rpb24odXNlcikge1xuICAgICRzY29wZS5hdXRoT2JqLiRjcmVhdGVVc2VyKHVzZXIpXG4gICAgLnRoZW4oZnVuY3Rpb24odXNlckRhdGEpIHtcbiAgICAgIGNvbnNvbGUubG9nKCd1c2VyIGNyZWF0ZWQ6JywgdXNlckRhdGEpO1xuICAgICAgcmV0dXJuICRzY29wZS5hdXRoT2JqLiRhdXRoV2l0aFBhc3N3b3JkKHVzZXIpO1xuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24oYXV0aERhdGEpIHtcbiAgICAgIGNvbnNvbGUubG9nKCd1c2VyIGxvZ2dlZCBpbjonLCBhdXRoRGF0YSk7XG4gICAgfSlcbiAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgfSk7XG4gIH07XG5cbiAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24odXNlcikge1xuICAgICRzY29wZS5hdXRoT2JqLiRhdXRoV2l0aFBhc3N3b3JkKHVzZXIpXG4gICAgLnRoZW4oZnVuY3Rpb24oYXV0aERhdGEpIHtcbiAgICAgIGNvbnNvbGUubG9nKCd1c2VyIGxvZ2dlZCBpbjonLCBhdXRoRGF0YSk7XG4gICAgfSlcbiAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG4gICAgfSk7XG4gIH07XG59KTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdmaXJlQXBwJyk7XG5cbmFwcC5jb250cm9sbGVyKCdwcm9maWxlQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkbG9nLCBwcm9maWxlKSB7XG4gICRzY29wZS5wcm9maWxlID0gcHJvZmlsZTtcblxuICAkc2NvcGUub3BlbiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxuICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL2VkaXRQcm9maWxlTW9kYWwuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnZWRpdFByb2ZpbGVNb2RhbEN0cmwnLFxuICAgICAgc2l6ZTogJ2xnJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgcHJvZmlsZVRvRWRpdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuY29weSgkc2NvcGUucHJvZmlsZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKGVkaXRlZFByb2ZpbGUpIHtcbiAgICAgICRzY29wZS5wcm9maWxlLm5hbWUgPSBlZGl0ZWRQcm9maWxlLm5hbWU7XG4gICAgICAkc2NvcGUucHJvZmlsZS5jb2xvciA9IGVkaXRlZFByb2ZpbGUuY29sb3I7XG4gICAgICAkc2NvcGUucHJvZmlsZS4kc2F2ZSgpO1xuICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgJGxvZy5pbmZvKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTtcbiAgICB9KTtcbiAgfTtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignZWRpdFByb2ZpbGVNb2RhbEN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBwcm9maWxlVG9FZGl0KSB7XG4gICRzY29wZS5lZGl0UHJvZmlsZSA9IHByb2ZpbGVUb0VkaXQ7XG4gICRzY29wZS5zYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLmVkaXRQcm9maWxlKTtcbiAgfTtcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTtcbiAgfTtcbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2ZpcmVBcHAnKTtcblxuYXBwLmNvbnRyb2xsZXIoJ3RocmVhZHNDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICR0aHJlYWRzKSB7XG4gIGNvbnNvbGUubG9nKCd0aHJlYWRzQ3RybCcpO1xuXG4gICRzY29wZS50aHJlYWRzID0gJHRocmVhZHMuZ2V0QXJyYXkoKTtcblxuICAkc2NvcGUuYWRkVGhyZWFkID0gZnVuY3Rpb24oKSB7XG4gICAgJHRocmVhZHMuY3JlYXRlKCRzY29wZS5uZXdUaHJlYWQuc3ViamVjdCk7XG4gICAgJHNjb3BlLm5ld1RocmVhZCA9IHt9O1xuICB9O1xufSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZmlyZUFwcCcpO1xuXG5hcHAuZmFjdG9yeSgnUHJvZmlsZUZhY3RvcnknLCBmdW5jdGlvbigkZmlyZWJhc2VPYmplY3QsIEZCX1VSTCkge1xuICByZXR1cm4gZnVuY3Rpb24odWlkKSB7XG4gICAgaWYoIXVpZCkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH07XG4gICAgdmFyIHByb2ZpbGVzUmVmID0gbmV3IEZpcmViYXNlKEZCX1VSTCArICdwcm9maWxlcycpO1xuICAgIHZhciB1c2VyUmVmID0gcHJvZmlsZXNSZWYuY2hpbGQodWlkKTtcbiAgICByZXR1cm4gJGZpcmViYXNlT2JqZWN0KHVzZXJSZWYpO1xuICB9O1xufSk7XG5cbmFwcC5mYWN0b3J5KCckdHdlZXRzJywgZnVuY3Rpb24oJGZpcmViYXNlQXJyYXksIEZCX1VSTCkge1xuICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZCX1VSTCk7XG4gIHZhciB0d2VldHNSZWYgPSByZWYuY2hpbGQoJ3R3ZWV0cycpO1xuICByZXR1cm4gJGZpcmViYXNlQXJyYXkodHdlZXRzUmVmKTtcbn0pO1xuXG5hcHAuZmFjdG9yeSgnJGF1dGhPYmonLCBmdW5jdGlvbigkZmlyZWJhc2VBdXRoLCBGQl9VUkwpIHtcbiAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGQl9VUkwpO1xuICByZXR1cm4gJGZpcmViYXNlQXV0aChyZWYpO1xufSk7XG5cbmFwcC5zZXJ2aWNlKCckdGhyZWFkcycsIGZ1bmN0aW9uKCRmaXJlYmFzZUFycmF5LCAkZmlyZWJhc2VPYmplY3QsIEZCX1VSTCkge1xuICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZCX1VSTCk7XG4gIHZhciB0aHJlYWRzUmVmID0gcmVmLmNoaWxkKCd0aHJlYWRzJyk7XG5cbiAgdGhpcy5nZXRBcnJheSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkZmlyZWJhc2VBcnJheSh0aHJlYWRzUmVmKTtcbiAgfTtcblxuICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uKHN1YmplY3QpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRBcnJheSgpLiRsb2FkZWQoKVxuICAgIC50aGVuKGZ1bmN0aW9uKHRocmVhZHMpIHtcbiAgICAgIHJldHVybiB0aHJlYWRzLiRhZGQgKHtcbiAgICAgICAgc3ViamVjdDogc3ViamVjdFxuICAgICAgfSlcbiAgICB9KVxuICB9O1xuICB0aGlzLmdldFRocmVhZCA9IGZ1bmN0aW9uKHRocmVhZElkKSB7XG4gICAgdmFyIHNpbmdsZVRocmVhZFJlZiA9IHRocmVhZHNSZWYuY2hpbGQodGhyZWFkSWQpO1xuICAgIHJldHVybiAkZmlyZWJhc2VPYmplY3Qoc2luZ2xlVGhyZWFkUmVmKTtcbiAgfTtcbiAgdGhpcy5nZXRQb3N0cyA9IGZ1bmN0aW9uKHRocmVhZElkKSB7XG4gICAgdmFyIHBvc3RzUmVmID0gdGhyZWFkc1JlZi5jaGlsZCh0aHJlYWRJZCkuY2hpbGQoJ3Bvc3RzJyk7XG4gICAgcmV0dXJuICRmaXJlYmFzZUFycmF5KHBvc3RzUmVmKTtcbiAgfVxufSlcbi8vIH0pXG4vLyBhcHAuZmFjdG9yeSgnJHRocmVhZHMnLCBmdW5jdGlvbigkZmlyZWJhc2VBcnJheSwgRkJfVVJMKSB7XG4vLyAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRkJfVVJMKTtcbi8vICAgdmFyIHRocmVhZHNSZWYgPSByZWYuY2hpbGQoJ3RocmVhZHMnKTtcbi8vXG4vLyAgIHJldHVybiB7XG4vLyAgICAgZ2V0QXJyYXkgPSBmdW5jdGlvbigpIHtcbi8vICAgICAgIHJldHVybiAkZmlyZWJhc2VBcnJheSh0aHJlYWRzUmVmKTtcbi8vICAgICB9LFxuLy8gICAgIGNyZWF0ZSA9IGZ1bmN0aW9uKHN1YmplY3QpIHtcbi8vICAgICAgIHJldHVybiB0aGlzLmdldEFycmF5KCkuJGxvYWRlZCgpXG4vLyAgICAgICAudGhlbihmdW5jdGlvbih0aHJlYWRzKVxuLy8gICAgICAgICByZXR1cm4gdGhyZWFkcy4kYWRkICh7XG4vLyAgICAgICAgIHN1YmplY3Q6IHN1YmplY3Rcbi8vICAgICAgICAgfSlcbi8vICAgICAgIH0pXG4vLyAgICAgfVxuLy8gfSlcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
